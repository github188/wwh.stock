(function() {
    (function() {
        var winResize = function() {
            this.queue = [];
            this.orignal = {
                height: null,
                width: null
            };
            this.state = true;
            this.waiting = null;
            this.doing = function() {
                var self = this;
                if (self.state == false) {
                    return
                }
                self.state = false;
                clearTimeout(self.waiting);
                this.waiting = setTimeout(function() {
                    var cache = getRect;
                    if (cache.height != self.orignal.height || cache.width != self.orignal.width) {
                        self.callback()
                    } else {
                        self.state = true;
                        return
                    }
                }, 100)
            }
            ;
            this.addEvent = function(callback) {
                this.queue.push(callback)
            }
            ;
            this.callback = function() {
                var self = this;
                for (var i = 0, j = self.queue.length; i < j; i++) {
                    eval(self.queue[i])()
                }
                self.state = true
            }
            ;
            this.init = function() {
                var self = this;
                self.orignal = getRect();
                window.onresize = function() {
                    self.doing()
                }
            }
            ;
            var getRect = function() {
                var win_width = document.documentElement.clientWidth || document.body.clientWidth;
                var win_height = document.documentElement.clientHeight || document.body.clientHeight;
                return {
                    width: win_width,
                    height: win_height
                }
            }
        };
        window.WinResize = new winResize();
        WinResize.init()
    })();
    var webShare = {
        _shareBox: null,
        _url: "",
        _title: "",
        _pic: "",
        _float: "left",
        _top: 100,
        source: "\u4e1c\u65b9\u8d22\u5bcc\u7f51\u6570\u636e\u9891\u9053",
        sourceUrl: "http://data.eastmoney.com/zjlx/",
        sinaApps: {
            main: {
                appkey: "3050999700",
                ralateuid: "1801487174"
            },
            fund: {
                appkey: "1667889534",
                ralateuid: "2248818320"
            }
        },
        init: function(opt, _float) {
            this._url = (!!opt && !!opt.url && opt.url != "") ? opt.url : location.href;
            this._title = (!!opt && !!opt.title && opt.title != "") ? opt.title : document.title;
            this._pic = (!!opt && !!opt.pic && opt.pic != "") ? opt.pic : "";
            this._float = (!!_float && _float != "" && _float != "left") ? _float : "left";
            this._top = (!!opt && !!opt._top && opt._top != "") ? opt._top : 100;
            if (this._url == "" || this._title == "") {
                alert("\u9519\u8bef\u7684\u94fe\u63a5\u5730\u5740\u6216\u6807\u9898");
                return
            }
            this.sinaApp = this.sinaApps.main;
            if (!!opt && !!opt.channel && opt.channel == "fund") {
                this.source = "\u4e1c\u65b9\u8d22\u5bcc\u7f51\u6570\u636e\u9891\u9053";
                this.sourceUrl = "http://data.eastmoney.com/zjlx/";
                this.sinaApp = this.sinaApps.fund
            }
            this._url = encodeURIComponent(this._url);
            if (this._title.indexOf("\u8d44\u91d1\u6d41\u5411") != -1) {
                var code = this._title.match(/^.*\(\d+\)/ig);
                if (code != null && code != "") {
                    this._title = "\u4e1c\u65b9\u8d22\u5bcc\u7f51\u6570\u636e\u4e2d\u5fc3\u63d0\u4f9b" + code + "\u5b9e\u65f6\u8d44\u91d1\u6d41\u5411\u6570\u636e\uff0c\u6301\u7eed\u8ddf\u8e2a\u4e3b\u529b\u8d44\u91d1 _ \u4e1c\u65b9\u8d22\u5bcc\u7f51"
                }
            }
            this._title = encodeURIComponent(this._title);
            this._pic = encodeURIComponent(this._pic);
            this.source = encodeURIComponent(this.source);
            this.ie = (function() {
                var undef, v = 3, div = document.createElement("div"), all = div.getElementsByTagName("i");
                while (div.innerHTML = "<!--[if gt IE " + (++v) + "]><i></i><![endif]-->",
                    all[0]) {}
                return v > 4 ? v : undef
            }());
            this._left = this.getLeft();
            if (this._left <= 0) {
                return
            }
            //this.createLinkArea();
            this.listenit()
        },
        getLeft: function() {
            var win_width = document.documentElement.clientWidth || document.body.clientWidth;
            var win_height = document.documentElement.clientHeight || document.body.clientHeight;
            var _left = (win_width - 1000) / 2 - 20;
            var _top = 450;
            if (win_height < 556) {
                _top = win_height - 106
            }
            this._top = _top;
            return _left < 0 ? "0px" : _left + "px"
        },
        listenit: function() {
            var _this = this;
            WinResize.addEvent(function() {
                _this._shareBox.style.left = _this.getLeft();
                _this._shareBox.style.top = _this._top + "px"
            })
        },
        getBody: function() {
            if (document.compatMode == "CSS1Compat") {
                this.dBody = (document.documentElement) ? document.documentElement : document.body
            } else {
                this.dBody = document.body
            }
        },
        createLinkArea: function() {
            var cssTxt = ".shareWebBox { background:#FFF; font-size:12px; overflow:hidden;position:fixed; top:" + this._top + "px; " + this._float + ":" + this._left + ";z-index:9999}.shareWebMain { color:#FFF; background:#1b5086;}.shareWebMain span{ background:url(http://topic.eastmoney.com/images/shareico.gif) no-repeat;cursor:pointer; float:left; width:20px; height:87px; padding-top:19px; text-align:center;}.shareWebSub { float:left; width:120px;height:100px;padding:2px 0; background:#FFF;overflow:hidden;border:1px solid #6f92a5;border-left:0px solid #6f92a5 }.shareWebBox ul {list-style:none; margin:0 auto; padding:0; width:100px;}.shareWebBox li { height:19px; line-height:19px; overflow:hidden;width:100px;display:inline;}.shareWebBox li a { float:left;padding:2px 5px 1px 27px; color:#002D82 !important;background:url(http://topic.eastmoney.com/images/shareico.gif) no-repeat -45px 2px;border:1px #ffffff solid;width:68px;text-align:left;maring-bottom:1px;text-decoration:underline;}.shareWebBox li a:hover {border:1px #E5E5E5 solid;background-color:#F2F2F2;text-decoration:underline;}.shareWebBox li .red { color:#CC0000 !important;}.shareWebBox .sina a{background-position:-45px -27px;}.shareWebBox .qq a{background-position:-45px -57px;}.shareWebBox .renren a{background-position:-45px -87px;}";
            if (this.ie == 6) {
                cssTxt += "html {_background-image:url(about:blank);_background-attachment:fixed;}.shareWebBox {_position:absolute; _top:expression((documentElement.scrollTop + " + this._top + ") + 'px');}"
            }
            var style = document.createElement("style");
            style.type = "text/css";
            document.getElementsByTagName("head").item(0).appendChild(style);
            if (style.styleSheet) {
                style.styleSheet.cssText = cssTxt
            } else {
                var txtNode = document.createTextNode(cssTxt);
                style.appendChild(txtNode)
            }
            var subAreaId = "sharewebsub";
            var shareLink = '<div class="shareWebMain" id="shareWebMain" onmouseover="webShare.showSub(true)" onmouseout="webShare.showSub(false)">';
            if (this._float == "left") {
                shareLink += "<span></span>"
            }
            shareLink += '<div class="shareWebSub" id="' + subAreaId + '" style="display:none">	<ul class="shareWebLink">		<li class="eastmoney"><a href="javascript:void(0);" onclick="webShare.shareTo(\'eastmoney\')" target="_self" class="red"><i></i>\u8d22\u8ff7\u5fae\u535a</a></li>		<li class="sina"><a href="javascript:void(0);" onclick="webShare.shareTo(\'sina\')" target="_self"><i></i>\u65b0\u6d6a\u5fae\u535a</a></li>		<li class="qq"><a href="javascript:void(0);" onclick="webShare.shareTo(\'qq\')" target="_self"><i></i>\u817e\u8baf\u5fae\u535a</a></li>		<li class="renren"><a href="javascript:void(0);" onclick="webShare.shareTo(\'renren\')" target="_self"><i></i>\u4eba \u4eba \u7f51</a></li>	</ul></div>';
            if (this._float == "right") {
                shareLink += "<span></span>"
            }
            shareLink += "</div>";
            if (!!this._shareBox || this._shareBox == null) {
                this._shareBox = document.createElement("div");
                this._shareBox.className = "shareWebBox";
                this._shareBox.innerHTML = shareLink;
                document.body.insertBefore(this._shareBox, document.body.firstChild);
                this.shareSubArea = document.getElementById(subAreaId)
            }
        },
        showSub: function(x) {
            this.shareSubArea.style.display = (x == true) ? "block" : "none"
        },
        shareTo: function(dest) {
            switch (dest.toLowerCase()) {
                case "sina":
                    shareUrl = "http://service.weibo.com/share/share.php?url=" + this._url + "&appkey=" + this.sinaApp.appkey + "&title=" + this._title + "&pic=" + this._pic + "&ralateUid=" + this.sinaApp.ralateuid + "&source=" + this.source + "&sourceUrl=" + this.sourceUrl;
                    break;
                case "qq":
                    shareUrl = "http://v.t.qq.com/share/share.php?url=" + this._url + "&appkey=801004939&site=" + this.sourceUrl + "&title=" + this._title + "&pic=" + this._pic;
                    break;
                case "renren":
                    shareUrl = "http://share.renren.com/share/buttonshare.do?link=" + this._url + "&title=" + this.source + "&content=" + this._title;
                    break;
                case "eastmoney":
                default:
                    shareUrl = "http://t.eastmoney.com/share.aspx?url=" + this._url + "&title=" + this._title + "&r=" + Math.random();
                    break
            }
            window.open(shareUrl);
            this.showSub()
        }
    };
    window.webShare = webShare;
    webShare.init(null, "left")
})();
